# 灵感绿洲 - 开发指南

## 🎯 项目概述

**灵感绿洲** 是一个现代化的团队协作创意平台，帮助团队收集、管理和分析创意想法。

### 技术架构
- **前端**: Next.js 14 + TypeScript + Tailwind CSS + shadcn/ui
- **后端**: Node.js + Express + TypeScript + PostgreSQL + Prisma
- **AI服务**: OpenRouter API（多模型支持）
- **缓存**: Redis（可选）

## 🚀 快速开始

### 环境要求
- Node.js >= 18.0.0
- PostgreSQL >= 13
- Redis (可选)
- pnpm (推荐)

### 1. 克隆项目
```bash
git clone <repository-url>
cd 灵感绿洲
```

### 2. 安装依赖
```bash
# 前端依赖
pnpm install

# 后端依赖  
cd backend
pnpm install
cd ..
```

### 3. 环境配置

**后端环境配置:**
```bash
cd backend
cp .env.example .env
```

编辑 `backend/.env`:
```env
# 数据库配置
DATABASE_URL="postgresql://username:password@localhost:5432/inspiration_oasis"

# OpenRouter API配置
OPENROUTER_API_KEY=your_openrouter_api_key_here

# 服务器配置  
PORT=3001
CORS_ORIGIN=http://localhost:3000
```

### 4. 数据库设置
```bash
cd backend

# 生成Prisma客户端
pnpm db:generate

# 创建数据库并推送结构
pnpm db:push

# 初始化测试数据
pnpm db:seed
```

### 5. 启动服务

**方案一：分别启动**
```bash
# 启动后端 (终端1)
cd backend
pnpm dev

# 启动前端 (终端2)  
cd ..
pnpm dev
```

**方案二：同时启动**
```bash
# 在项目根目录
pnpm dev:all
```

### 6. 访问应用
- 前端: http://localhost:3000
- 后端API: http://localhost:3001
- 健康检查: http://localhost:3001/health
- 数据库管理: `pnpm db:studio` (在backend目录)

## 📁 项目结构

```
灵感绿洲/
├── 📱 前端 (Next.js)
│   ├── app/                 # App Router页面
│   ├── components/          # UI组件库
│   ├── lib/                 # 工具函数
│   └── public/              # 静态资源
│
├── 🚀 后端 (Express API)
│   ├── src/
│   │   ├── controllers/     # 控制器
│   │   ├── routes/          # 路由定义
│   │   ├── services/        # 业务逻辑
│   │   ├── middleware/      # 中间件
│   │   └── config/          # 配置文件
│   ├── prisma/             # 数据库模型
│   └── scripts/            # 工具脚本
│
└── 📚 文档
    ├── API-文档.md          # API接口文档
    ├── ai-service-design.md # AI服务设计
    └── 开发指南.md          # 本文档
```

## 🔧 开发工作流

### 前端开发
```bash
# 启动开发服务器
pnpm dev

# 构建生产版本
pnpm build

# 代码检查
pnpm lint
```

### 后端开发
```bash
cd backend

# 启动开发服务器（热重载）
pnpm dev

# 数据库相关
pnpm db:studio     # 数据库管理界面
pnpm db:push       # 推送数据库更改
pnpm db:seed       # 重新初始化测试数据

# 代码检查
pnpm lint
```

### 数据库管理
```bash
# 查看数据库（Web界面）
cd backend && pnpm db:studio

# 重置数据库
cd backend && pnpm db:push --force-reset

# 重新初始化测试数据
cd backend && pnpm db:seed
```

## 🤖 AI功能配置

### OpenRouter设置
1. 访问 [OpenRouter](https://openrouter.ai) 注册账号
2. 获取API密钥
3. 在 `backend/.env` 中配置:
```env
OPENROUTER_API_KEY=your_api_key_here
```

### AI功能测试
```bash
# 测试AI内容增强
curl -X POST http://localhost:3001/api/ai/enhance \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{"content": "测试内容", "type": "expand"}'

# 测试智能总结
curl -X POST http://localhost:3001/api/ai/summarize \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{"content": "需要总结的长文本..."}'
```

## 📝 功能开发状态

### ✅ 已完成功能
- [x] **基础架构** - 前后端框架搭建
- [x] **数据库设计** - 完整的数据模型
- [x] **灵感墙功能** - 创建、查看、点赞、评论、归档
- [x] **AI服务集成** - OpenRouter多模型支持
- [x] **内容增强** - AI优化、扩展、润色
- [x] **智能总结** - 关键信息提取
- [x] **AI对话** - 深度分析交流
- [x] **标签推荐** - 自动分类标记
- [x] **简化认证** - 开发阶段用户模拟
- [x] **API文档** - 完整接口说明

### 🔄 进行中功能
- [ ] **资产库管理** - 完整的CRUD操作
- [ ] **数据分析** - 趋势统计和洞察
- [ ] **文件上传** - 图片和文档支持

### 📋 计划中功能
- [ ] **完整认证** - JWT + OAuth SSO
- [ ] **实时通知** - WebSocket推送
- [ ] **权限管理** - 角色和权限控制
- [ ] **单元测试** - 前后端测试用例
- [ ] **部署配置** - Docker + CI/CD

## 🛠️ API使用示例

### 认证说明
当前使用简化认证方案，在请求头中添加：
```bash
X-User-ID: user_001
X-User-Name: 张三
```

### 核心API示例

**获取灵感列表:**
```bash
curl "http://localhost:3001/api/ideas?page=1&limit=10&sort=latest"
```

**发布新灵感:**
```bash
curl -X POST http://localhost:3001/api/ideas \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -H "X-User-Name: 张三" \
  -d '{
    "content": "我的新想法...",
    "tags": ["AI", "创新"]
  }'
```

**AI内容增强:**
```bash
curl -X POST http://localhost:3001/api/ai/enhance \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{
    "content": "创建一个AI助手",
    "type": "expand"
  }'
```

## 🐛 故障排查

### 常见问题

**1. 数据库连接失败**
```bash
# 检查PostgreSQL状态
brew services list | grep postgresql

# 启动PostgreSQL
brew services start postgresql

# 检查连接
psql $DATABASE_URL
```

**2. AI服务不可用**
- 检查 `OPENROUTER_API_KEY` 是否正确设置
- 查看控制台错误日志
- AI服务会自动降级到模拟数据

**3. 前端页面空白**
- 检查后端服务是否启动
- 查看浏览器控制台错误
- 确认CORS配置正确

**4. Redis连接失败**
- Redis是可选的，连接失败会自动使用内存缓存
- 启动Redis: `brew services start redis`

### 调试模式
```bash
# 后端详细日志
cd backend
NODE_ENV=development pnpm dev

# 查看数据库查询
# Prisma会在控制台输出SQL查询
```

## 🚀 部署指南

### 开发环境部署
项目已配置好开发环境，按照快速开始即可。

### 生产环境部署

**后端部署 (Railway/Vercel/Heroku):**
1. 设置环境变量
2. 配置数据库连接
3. 运行数据库迁移
4. 启动应用

**前端部署 (Vercel/Netlify):**
1. 连接Git仓库
2. 配置构建命令: `pnpm build`
3. 设置输出目录: `.next`
4. 配置环境变量

### Docker部署
```bash
# 构建后端镜像
cd backend
docker build -t inspiration-oasis-backend .

# 构建前端镜像  
cd ..
docker build -t inspiration-oasis-frontend .
```

## 🤝 贡献指南

### 代码规范
- 使用TypeScript严格模式
- 遵循ESLint配置
- 提交前运行代码检查
- 编写清晰的提交信息

### 开发流程
1. 创建功能分支: `git checkout -b feature/new-feature`
2. 开发并测试功能
3. 提交代码: `git commit -m "feat: add new feature"`
4. 推送分支: `git push origin feature/new-feature`
5. 创建Pull Request

### 分支命名规范
- `feature/` - 新功能开发
- `fix/` - 错误修复
- `docs/` - 文档更新
- `refactor/` - 代码重构
- `test/` - 测试相关

## 📞 获取帮助

### 文档资源
- [API文档](./API-文档.md) - 完整的接口说明
- [AI服务设计](./ai-service-design.md) - AI功能架构
- [后端README](./backend/README.md) - 后端详细说明

### 技术支持
- 项目Issues - 报告问题和功能请求
- 开发交流群 - 日常讨论和答疑
- 代码Review - 代码质量保证

### 相关链接
- [Next.js文档](https://nextjs.org/docs)
- [Prisma文档](https://www.prisma.io/docs)
- [OpenRouter文档](https://openrouter.ai/docs)
- [shadcn/ui组件](https://ui.shadcn.com)

---

**Happy Coding! 🎉**
