# 灵感绿洲后端 - 快速测试指南

## 🚀 一键启动测试

### 1. 环境准备
```bash
# 确保已安装必要环境
node --version  # >= 18.0.0
psql --version  # PostgreSQL >= 13
redis-cli ping  # Redis (可选)
```

### 2. 快速启动
```bash
# 1. 进入后端目录
cd backend

# 2. 安装依赖
pnpm install

# 3. 配置环境变量
cp .env.example .env
# 编辑 .env 文件中的数据库连接

# 4. 初始化数据库
pnpm db:generate
pnpm db:push
pnpm db:seed

# 5. 启动服务
pnpm dev
```

## 🧪 API接口测试

### 基础测试
```bash
# 健康检查
curl http://localhost:3001/health

# API信息
curl http://localhost:3001/api
```

### 灵感墙功能测试
```bash
# 1. 获取灵感列表
curl "http://localhost:3001/api/ideas?page=1&limit=5"

# 2. 发布新灵感
curl -X POST http://localhost:3001/api/ideas \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -H "X-User-Name: 测试用户" \
  -d '{
    "content": "测试灵感：开发一个AI驱动的代码审查工具",
    "tags": ["AI", "开发工具", "测试"]
  }'

# 3. 点赞灵感 (需要先获取一个idea的ID)
curl -X POST http://localhost:3001/api/ideas/[IDEA_ID]/like \
  -H "X-User-ID: user_002" \
  -H "X-User-Name: 其他用户"

# 4. 添加评论
curl -X POST http://localhost:3001/api/ideas/[IDEA_ID]/comments \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_003" \
  -H "X-User-Name: 评论用户" \
  -d '{
    "content": "这个想法很有创意，我觉得可以加入更多自动化功能。"
  }'
```

### AI服务功能测试
```bash
# 1. AI内容增强
curl -X POST http://localhost:3001/api/ai/enhance \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{
    "content": "创建一个AI助手",
    "type": "expand",
    "context": "技术开发项目"
  }'

# 2. 智能总结
curl -X POST http://localhost:3001/api/ai/summarize \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{
    "content": "人工智能技术正在快速发展，它在各个行业都有广泛的应用前景。从医疗诊断到自动驾驶，从语音识别到图像处理，AI技术正在改变我们的生活方式。然而，随着AI技术的普及，我们也需要关注数据隐私、算法公平性等问题。",
    "summary_type": "brief"
  }'

# 3. AI对话
curl -X POST http://localhost:3001/api/ai/chat \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{
    "message": "我想开发一个AI代码审查工具，你有什么建议？",
    "context": "软件开发工具创新"
  }'

# 4. 标签推荐
curl -X POST http://localhost:3001/api/ai/tags/suggest \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -d '{
    "content": "开发一个基于机器学习的智能推荐系统，能够分析用户行为并提供个性化内容推荐",
    "max_tags": 5
  }'

# 5. 每日AI简报
curl "http://localhost:3001/api/ai/brief/daily?date=2023-11-16&categories=AI,技术"
```

### 资产库功能测试
```bash
# 1. 获取资产列表
curl "http://localhost:3001/api/assets?page=1&limit=5&category=技术方案"

# 2. 创建新资产
curl -X POST http://localhost:3001/api/assets \
  -H "Content-Type: application/json" \
  -H "X-User-ID: user_001" \
  -H "X-User-Name: 测试用户" \
  -d '{
    "title": "AI代码审查工具设计方案",
    "description": "基于机器学习的智能代码审查工具完整设计方案",
    "content": "# 项目概述\n\n本方案旨在开发一个AI驱动的代码审查工具...",
    "category": "技术方案",
    "tags": ["AI", "代码审查", "机器学习"]
  }'

# 3. 获取分类列表
curl http://localhost:3001/api/assets/categories

# 4. 获取热门资产
curl "http://localhost:3001/api/assets/popular?limit=5"

# 5. 获取用户资产统计
curl http://localhost:3001/api/assets/stats/user \
  -H "X-User-ID: user_001"
```

### 数据分析功能测试
```bash
# 1. 仪表板统计数据
curl "http://localhost:3001/api/analytics/dashboard?period=week"

# 2. 趋势分析数据
curl "http://localhost:3001/api/analytics/trends?period=week&type=all"

# 3. AI洞察报告
curl "http://localhost:3001/api/analytics/insights?type=content_quality"

# 4. 用户活动统计
curl "http://localhost:3001/api/analytics/user-activity?period=week" \
  -H "X-User-ID: user_001"

# 5. 图表数据
curl "http://localhost:3001/api/analytics/chart-data?metric=ideas&period=week&granularity=day"
```

### 文件上传功能测试
```bash
# 1. 单文件上传 (需要准备一个测试图片文件)
curl -X POST http://localhost:3001/api/upload \
  -H "X-User-ID: user_001" \
  -F "file=@/path/to/test-image.jpg" \
  -F "type=image" \
  -F "entity_type=IDEA" \
  -F "entity_id=test_entity_id"

# 2. 获取文件统计
curl http://localhost:3001/api/upload/stats \
  -H "X-User-ID: user_001"

# 3. 获取文件列表
curl "http://localhost:3001/api/upload/files?page=1&limit=10&type=image"
```

## 📊 测试数据说明

### 初始化数据包含：
- **4个测试用户**: user_001 到 user_004
- **10条测试灵感**: 涵盖AI、开发、设计等领域
- **5个测试资产**: 从灵感归档的资产
- **30+个标签**: 覆盖各个技术领域
- **随机评论和点赞**: 模拟用户互动
- **7天简报数据**: AI简报历史记录
- **30天统计数据**: 系统使用统计

### 测试用户信息：
```json
{
  "user_001": "张三 (zhangsan@example.com)",
  "user_002": "李四 (lisi@example.com)", 
  "user_003": "王五 (wangwu@example.com)",
  "user_004": "赵六 (zhaoliu@example.com)"
}
```

## 🔍 测试验证要点

### 1. 基础功能验证
- [ ] 服务启动成功，健康检查通过
- [ ] 数据库连接正常，测试数据加载完成
- [ ] API路由正确响应，返回数据格式正确

### 2. 业务逻辑验证
- [ ] 灵感CRUD操作正常
- [ ] 点赞和评论功能工作正常
- [ ] 资产创建和归档流程正确
- [ ] AI服务响应正常（有API Key）或降级模拟数据

### 3. 数据一致性验证
- [ ] 创建灵感后，统计数据更新
- [ ] 点赞操作后，计数正确更新
- [ ] 归档操作后，资产库中出现新记录
- [ ] 标签使用计数正确累计

### 4. 性能和缓存验证
- [ ] 重复请求响应时间明显改善（缓存生效）
- [ ] 大量数据查询响应时间合理
- [ ] 并发请求处理正常

## ⚠️ 常见问题排查

### 1. 数据库连接失败
```bash
# 检查PostgreSQL服务
brew services list | grep postgresql
brew services start postgresql

# 检查连接字符串
echo $DATABASE_URL
psql $DATABASE_URL
```

### 2. Redis连接失败（可选）
```bash
# 检查Redis服务
redis-cli ping
brew services start redis

# 应用会自动降级到内存缓存
```

### 3. AI服务不可用
```bash
# 检查API密钥配置
echo $OPENROUTER_API_KEY

# 应用会自动降级到模拟数据
```

### 4. 文件上传失败
```bash
# 检查上传目录权限
ls -la ./uploads/
mkdir -p ./uploads/{images,documents,other}
chmod 755 ./uploads/
```

## 🎯 性能基准测试

### 预期响应时间：
- **健康检查**: < 10ms
- **获取灵感列表**: < 100ms (首次) / < 20ms (缓存)
- **创建灵感**: < 200ms
- **AI服务**: < 3000ms (实际API) / < 50ms (模拟)
- **数据分析**: < 500ms (首次) / < 50ms (缓存)
- **文件上传**: < 1000ms (取决于文件大小)

### 并发测试建议：
```bash
# 使用ab工具进行并发测试
ab -n 100 -c 10 http://localhost:3001/api/ideas

# 使用curl进行简单压力测试
for i in {1..10}; do
  curl http://localhost:3001/api/ideas &
done
wait
```

## 🎉 测试完成标志

当以下所有测试通过时，说明后端系统运行正常：

✅ 健康检查返回成功  
✅ 能够获取灵感列表  
✅ 能够创建新灵感  
✅ AI服务正常响应  
✅ 数据分析API正常  
✅ 文件上传功能正常  
✅ 缓存机制生效  
✅ 错误处理正确  

**恭喜！您的灵感绿洲后端系统已经准备就绪！** 🚀
